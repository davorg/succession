#!/usr/bin/perl -CS

use strict;
use warnings;
use 5.010;

use Succession::Schema;
use DateTime;
use DateTime::Format::Strptime;

my $date = shift;

if (defined $date) {
  $date = DateTime::Format::Strptime->new(
    pattern => '%Y-%m-%d',
  )->parse_datetime($date);
} else {
  $date = DateTime->now;
}

my $sch = Succession::Schema->get_schema;

my ($sov) = $sch->resultset('Sovereign')->sovereign_on_date($date);

say 'Sovereign on ', $date->strftime('%d %B %Y'), ': ', $sov->name;

say 'Succession:';

my $i = 1;
say $i++, ': ', $_->describe for $sov->succession_on_date($date);
