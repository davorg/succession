#!/bin/bash
set -euo pipefail

dir="$(cd "$(dirname "$0")" && pwd)"
# shellcheck source=bin/func_defs
. "$dir/func_defs"

check_vars
mkdir -p "$dir/../data"

db="$(sqlite_db_path)"
out="$dir/../data/succession_dump.sql"
echo "Dumping SQLite: $db â†’ $out"
# sqlite3 .dump already includes PRAGMA foreign_keys=OFF; BEGIN TRANSACTION; ... COMMIT;
# We just need to add ANALYZE at the end
{
  sqlite3 "$db" .dump
  echo "ANALYZE;"
} > "$out"

echo "Wrote $out"

