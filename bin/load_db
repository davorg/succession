#!/bin/bash
set -euo pipefail

dir="$(cd "$(dirname "$0")" && pwd)"
# shellcheck source=bin/func_defs
. "$dir/func_defs"

# Custom check for load_db: we don't require the DB file to exist yet
path="$(sqlite_db_path)" || { echo "Missing SUCC_DB_PATH or SUCC_DSN(dbname)" >&2; exit 1; }
if [[ -z "$path" ]]; then
  echo "Missing/invalid SUCC_DB_PATH or SUCC_DSN" >&2
  exit 1
fi

in="$dir/../data/succession_dump.sql"
[[ -f "$in" ]] || { echo "Missing $in" >&2; exit 1; }

db="$(sqlite_db_path)"
echo "Loading into SQLite: $db"
# Load the SQL dump directly
sqlite3 "$db" < "$in"

echo "Load complete."

