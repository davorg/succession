#!/bin/bash
set -euo pipefail

dir="$(cd "$(dirname "$0")" && pwd)"
# shellcheck source=bin/func_defs
. "$dir/func_defs"

check_vars
mkdir -p "$dir/../../data"

out="$dir/../../data/succession.ddl"

if is_sqlite; then
  db="$(sqlite_db_path)"
  echo "Dumping SQLite DDL: $db → $out"
  # .schema prints CREATE statements (tables, indexes, triggers, views)
  sqlite3 "$db" .schema > "$out"
else
  echo "Dumping MySQL DDL: $SUCC_DB_NAME@$SUCC_DB_HOST → $out"
  mysqldump --no-data \
    -h"$SUCC_DB_HOST" \
    -P"${SUCC_DB_PORT:-3306}" \
    -u"$SUCC_DB_USER" \
    -p"$SUCC_DB_PASS" \
    "$SUCC_DB_NAME" > "$out"
fi

echo "Wrote $out"

