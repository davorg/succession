#!/usr/bin/perl -CS

use strict;
use warnings;
use feature 'say';

use Data::Dumper;
use Digest::SHA;
use Text::Unidecode;

use Succession::Schema;

my $person_rs = Succession::Schema->get_schema->resultset('Person');

while (my $p = $person_rs->next) {
  my $sha = Digest::SHA->new;

  my $slugname = lc unidecode($p->name =~ s/\W+/-/gr);
  $sha->add($slugname);
  $sha->add($p->born);
  my $slug = substr($sha->hexdigest, 0, 6) . '-' . $slugname;

  warn $p->name, ' / ', "$slug\n";

  $p->update({ slug => $slug });
}
