version: '3.8'

services:
  cache:
    image: memcached:1.5
    container_name: succession-cache
    command: memcached -m 128 -I 2m
    restart: unless-stopped

  app:
    image: davorg/succession:latest
    container_name: succession
    depends_on:
      - cache
    environment:
      # Use the baked-in SQLite file
      SUCC_DSN: "dbi:SQLite:dbname=/succession/data/los.sqlite;mode=ro;immutable=1"
      # or: SUCC_DB_PATH=/succession/data/los.sqlite
      SUCC_DB_VERSION: "2025-11-05+dev"     # bump per DB build to invalidate caches
      MEMCACHED_SERVERS: "cache:11211"      # only if/when you enable CHI
      PLACK_ENV: "production"
    # Map host 1701 -> container 8080 (we bind PORT=8080 in Dockerfile)
    ports:
      - "1701:8080"
    # Optional hardening; add tmpfs if anything needs /tmp
    read_only: true
    tmpfs:
      - /tmp
    restart: unless-stopped

